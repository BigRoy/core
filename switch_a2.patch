From 2be108abba4965ffa04cec4cbdfe629286ff9832 Mon Sep 17 00:00:00 2001
From: wijnand <wikoreman@gmail.com>
Date: Fri, 9 Mar 2018 16:35:27 +0100
Subject: [PATCH] Removed redundand import, add fallback to BlackmagicFusion
 module when no fusion instance is found

---
 avalon/fusion/pipeline.py | 7 ++++++-
 1 file changed, 6 insertions(+), 1 deletion(-)

diff --git a/avalon/fusion/pipeline.py b/avalon/fusion/pipeline.py
index 2b17895..877b51c 100644
--- a/avalon/fusion/pipeline.py
+++ b/avalon/fusion/pipeline.py
@@ -26,7 +26,6 @@ def ls():
     tools = comp.GetToolList(False).values()
     for tool in tools:
         if tool.ID in ["Loader"]:
-            from .pipeline import parse_container
             container = parse_container(tool)
             if container:
                 yield container
@@ -135,6 +134,12 @@ def parse_container(tool):
 def get_current_comp():
     """Hack to get current comp in this session"""
     fusion = getattr(sys.modules["__main__"], "fusion", None)
+    if not fusion:
+        try:
+            import BlackmagicFusion as bmf
+            fusion = bmf.scriptapp("Fusion", "localhost")
+        except Exception as e:
+            pass
     return fusion.CurrentComp if fusion else None
 
 
-- 
2.16.2.windows.1

