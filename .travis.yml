language: python

python:
  - 2.7

services:
  - docker

install:
  - docker run --name avalon-mongo -d mongo
  - docker build -t avalon/core -f Dockerfile-maya2016 .

script:
  # Run Tests
  - >
    docker run
    --rm
    -v $(pwd):/workspace
    --link avalon-mongo:mongo
    -e COVERALLS_REPO_TOKEN
    -e TRAVIS_JOB_ID
    -e AVALON_MONGO=mongodb://mongo:27017
    avalon/core

  # Build Documentation
  - >
    docker run
    --rm
    -v $(pwd):/workspace
    --entrypoint=mayapy
    avalon/core
    -m sphinx docs/source docs/build

before_deploy:
  - sudo chmod -R 777 docs/build/
  - cd docs/build
  - touch .nojekyll
  - ls -l

deploy:
  provider: pages
  skip_cleanup: true
  github_token: $GITHUB_TOKEN
  on:
    branch: master
